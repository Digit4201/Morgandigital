class PerformanceOptimizer{constructor(){this.config={lazyLoadOffset:100,imagePlaceholderColor:'#f3f4f6',criticalResourceTimeout:5e3,preloadLimit:3,cacheVersion:'1.0.0'},this.metrics={loadStart:performance.now(),resourcesLoaded:0,imagesOptimized:0,cacheHits:0},this.initialize()}initialize(){'loading'===document.readyState?document.addEventListener('DOMContentLoaded',()=>this.startOptimizations()):this.startOptimizations()}startOptimizations(){console.log('ðŸš€ Performance Optimizer initialized'),this.optimizeCriticalResources(),this.setupLazyLoading(),this.optimizeImages(),this.setupIntelligentPreloading(),this.optimizeAnimations(),this.setupCacheStrategy(),this.monitorPerformance(),setTimeout(()=>this.generatePerformanceReport(),3e3)}optimizeCriticalResources(){this.inlineCriticalCSS(),this.preloadCriticalResources(),this.optimizeFontLoading(),this.deferNonCriticalJS()}inlineCriticalCSS(){const e=this.extractCriticalCSS(['.navbar','.hero','.urgency-banner','.btn-primary','h1, h2','.container']);if(e){const t=document.createElement('style');t.textContent=e,t.setAttribute('data-critical','true'),document.head.insertBefore(t,document.head.firstChild)}}extractCriticalCSS(){return`\n            .navbar { position: fixed; top: 0; width: 100%; z-index: 1000; }\n            .hero { padding: 10rem 0 6rem; }\n            .btn-primary { display: inline-flex; padding: 0.875rem 1.75rem; }\n            .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }\n            .urgency-banner { background: linear-gradient(135deg, #1f2937 0%, #374151 100%); }\n        `}preloadCriticalResources(){[{href:'style.css',as:'style'},{href:'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap',as:'style'},{href:'portfolio-greenhorizens.webp',as:'image'}].forEach(e=>{if(!document.querySelector(`link[href=\"${e.href}\"]`)){const t=document.createElement('link');t.rel='preload',t.href=e.href,t.as=e.as,'style'===e.as&&(t.onload=()=>{t.rel='stylesheet',this.metrics.resourcesLoaded++}),document.head.appendChild(t)}})}optimizeFontLoading(){['https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJfecnFHGPc.woff2','https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2'].forEach(e=>{const t=document.createElement('link');t.rel='preload',t.href=e,t.as='font',t.type='font/woff2',t.crossOrigin='anonymous',document.head.appendChild(t)});if('fontDisplay'in document.documentElement.style){const e=document.createElement('style');e.textContent=`\n                @font-face {\n                    font-family: 'Poppins';\n                    font-display: swap;\n                }\n                @font-face {\n                    font-family: 'Montserrat';\n                    font-display: swap;\n                }\n            `,document.head.appendChild(e)}}deferNonCriticalJS(){['vendor/tsparticles.bundle.min.js'].forEach(e=>{const t=document.querySelector(`script[src=\"${e}\"]`);t&&(t.defer=!0,t.setAttribute('data-deferred','true'))})}setupLazyLoading(){this.setupImageLazyLoading(),this.setupSectionLazyLoading(),this.setupEmbedLazyLoading()}setupImageLazyLoading(){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(this.loadImageOptimized(e.target),t.unobserve(e.target))})},{rootMargin:`${this.config.lazyLoadOffset}px`,threshold:.1});document.querySelectorAll('img[data-src]').forEach(t=>{this.addImagePlaceholder(t),e.observe(t)})}loadImageOptimized(e){const t=e.dataset.src;if(!t)return;const o=new Image;o.onload=()=>{e.style.opacity='0',e.style.transition='opacity 0.3s ease',setTimeout(()=>{e.src=t,e.style.opacity='1',e.classList.add('loaded'),e.removeAttribute('data-src'),this.metrics.imagesOptimized++},50)},o.onerror=()=>{console.warn('Failed to load image:',t),e.alt='Image failed to load',e.classList.add('error')},o.src=t}addImagePlaceholder(e){const t=e.getAttribute('width')||'100%',o=e.getAttribute('height')||'200px';e.style.backgroundColor=this.config.imagePlaceholderColor,e.style.width=t,e.style.height=o,e.style.objectFit='cover',e.classList.add('loading-placeholder')}setupSectionLazyLoading(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.activateSection(e.target)})},{rootMargin:'50px',threshold:.1});document.querySelectorAll('[data-lazy=\"section\"]').forEach(t=>{e.observe(t)})}activateSection(e){e.classList.add('section-loaded'),e.querySelectorAll('[data-lazy-load]').forEach(e=>{this.loadLazyElement(e)})}optimizeImages(){this.modernImageFormats(),this.setupResponsiveImages(),this.setupImageCompression()}modernImageFormats(){const e=this.supportsImageFormat('webp'),t=this.supportsImageFormat('avif');document.querySelectorAll('img[data-optimize]').forEach(o=>{const n=o.src;let s=n;t&&n.includes('.jpg')?s=n.replace(/\\.(jpg|jpeg)$/i,'.avif'):e&&n.includes('.jpg')&&(s=n.replace(/\\.(jpg|jpeg)$/i,'.webp')),this.testImageExists(s).then(e=>{e&&s!==n&&(o.src=s,console.log('Optimized image format used:',s))})})}supportsImageFormat(e){const t=document.createElement('canvas');return t.width=1,t.height=1,0===t.toDataURL(`image/${e}`).indexOf(`data:image/${e}`)}testImageExists(e){return new Promise(t=>{const o=new Image;o.onload=()=>t(!0),o.onerror=()=>t(!1),o.src=e})}setupResponsiveImages(){document.querySelectorAll('img[data-responsive]').forEach(e=>{const t=e.src,o=['320w','640w','960w','1280w'].map(e=>{const o=parseInt(e);return`${this.generateResponsiveSrc(t,o)} ${e}`}).join(', ');e.srcset=o,e.sizes='(max-width: 640px) 320px, (max-width: 960px) 640px, (max-width: 1280px) 960px, 1280px'})}generateResponsiveSrc(e,t){const o=e.split('.').pop(),n=e.replace(`.${o}`,'');return`${n}_${t}w.${o}`}setupIntelligentPreloading(){this.predictivePreloading(),this.hoverPreloading(),this.scrollBasedPreloading()}predictivePreloading(){this.analyzeNavigationPatterns().forEach(e=>{e.probability>.7&&this.preloadResource(e.resource)})}hoverPreloading(){document.addEventListener('mouseover',e=>{'A'===e.target.tagName&&(e=>{const t=e.target.href;t&&!this.isExternalLink(t)&&this.preloadPage(t)})(e)}),document.addEventListener('mouseover',e=>{'IMG'===e.target.tagName&&e.target.dataset.hoverSrc&&(e=>{const t=e.target.dataset.hoverSrc;this.preloadImage(t)})(e)})}scrollBasedPreloading(){let e=0;const t=this.throttle(()=>{const t=this.getScrollDepth();t>25&&e<=25&&this.preloadNextSection(),t>50&&e<=50&&this.preloadPricingResources(),t>75&&e<=75&&this.preloadContactFormAssets(),e=t},250);window.addEventListener('scroll',t)}optimizeAnimations(){this.optimizeCSSAnimations(),this.respectMotionPreferences(),this.optimizeScrollAnimations()}optimizeCSSAnimations(){document.querySelectorAll('[class*=\"animate\"], [class*=\"transition\"]').forEach(e=>{e.style.willChange='transform, opacity'});const e=document.createElement('style');e.textContent=`\n            .hero-visual, .floating-card, .benefit-card {\n                transform: translate3d(0, 0, 0);\n            }\n        `,document.head.appendChild(e)}respectMotionPreferences(){if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){const e=document.createElement('style');e.textContent=`\n                *, *::before, *::after {\n                    animation-duration: 0.01ms !important;\n                    animation-iteration-count: 1 !important;\n                    transition-duration: 0.01ms !important;\n                    scroll-behavior: auto !important;\n                }\n            `,document.head.appendChild(e)}}optimizeScrollAnimations(){let e=!1;const t=()=>{this.updateScrollBasedAnimations(),e=!1};window.addEventListener('scroll',()=>{e||(requestAnimationFrame(t),e=!0)})}setupCacheStrategy(){this.setupServiceWorker(),this.setupLocalStorageCache(),this.setupResourceCache()}setupServiceWorker(){'serviceWorker'in navigator&&navigator.serviceWorker.register('/sw.js',{scope:'/',updateViaCache:'none'}).then(e=>{console.log('Service Worker registered successfully'),this.metrics.cacheHits++}).catch(e=>{console.warn('Service Worker registration failed:',e)})}setupLocalStorageCache(){const e={set:(e,t,o=36e5)=>{const n={data:t,timestamp:Date.now(),expiry:o};localStorage.setItem(`morgan_cache_${e}`,JSON.stringify(n))},get:t=>{const o=localStorage.getItem(`morgan_cache_${t}`);if(!o)return null;const n=JSON.parse(o);return Date.now()-n.timestamp>n.expiry?(localStorage.removeItem(`morgan_cache_${t}`),null):(this.metrics.cacheHits++,n.data)},clear:()=>{Object.keys(localStorage).forEach(e=>{e.startsWith('morgan_cache_')&&localStorage.removeItem(e)})}};window.MorganCache=e}monitorPerformance(){this.observeCoreWebVitals(),this.monitorSlowResources(),this.setupPerformanceAnalysis()}observeCoreWebVitals(){if('PerformanceObserver'in window){try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),o=t[t.length-1];console.log('LCP:',o.startTime),this.reportMetric('lcp',o.startTime)});e.observe({entryTypes:['largest-contentful-paint']})}catch(e){console.warn('LCP observer not supported')}try{const e=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{console.log('FID:',e.processingStart-e.startTime),this.reportMetric('fid',e.processingStart-e.startTime)})});e.observe({entryTypes:['first-input']})}catch(e){console.warn('FID observer not supported')}try{let e=0;const t=new PerformanceObserver(t=>{for(const o of t.getEntries())o.hadRecentInput||(e+=o.value);console.log('CLS:',e),this.reportMetric('cls',e)});t.observe({entryTypes:['layout-shift']})}catch(e){console.warn('CLS observer not supported')}}}generatePerformanceReport(){const e=performance.now()-this.metrics.loadStart,t=performance.getEntriesByType('navigation')[0],o={timestamp:new Date().toISOString(),loadTime:Math.round(e),domContentLoaded:t?Math.round(t.domContentLoadedEventEnd-t.navigationStart):null,resourcesLoaded:this.metrics.resourcesLoaded,imagesOptimized:this.metrics.imagesOptimized,cacheHits:this.metrics.cacheHits,memoryUsage:this.getMemoryUsage(),connectionType:this.getConnectionType()};return console.log('ðŸ“Š Performance Report:',o),window.securityMonitor&&window.securityMonitor.logEvent('performance_report',o,'info'),o}throttle(e,t){let o;return function(){const n=arguments,s=this;o||(e.apply(s,n),o=!0,setTimeout(()=>o=!1,t))}}getScrollDepth(){const e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight;return Math.round(e/t*100)}isExternalLink(e){try{return new URL(e).hostname!==window.location.hostname}catch{return!1}}getMemoryUsage(){return'memory'in performance?{used:Math.round(performance.memory.usedJSHeapSize/1048576),total:Math.round(performance.memory.totalJSHeapSize/1048576)}:null}getConnectionType(){return'connection'in navigator?{effectiveType:navigator.connection.effectiveType,saveData:navigator.connection.saveData}:null}reportMetric(e,t){window.securityMonitor&&window.securityMonitor.logEvent('web_vital',{metric:e,value:Math.round(t),timestamp:performance.now()},'info')}analyzeNavigationPatterns(){return[]}preloadResource(e){console.log('Preloading:',e)}preloadPage(e){console.log('Preloading page:',e)}preloadImage(e){console.log('Preloading image:',e)}preloadNextSection(){console.log('Preloading next section')}preloadPricingResources(){console.log('Preloading pricing resources')}preloadContactFormAssets(){console.log('Preloading contact form assets')}updateScrollBasedAnimations(){}loadLazyElement(e){console.log('Loading lazy element:',e)}activateSection(e){e.classList.add('loaded')}monitorSlowResources(){}setupPerformanceAnalysis(){}setupResourceCache(){}}const serviceWorkerCode=`\n// Service Worker pour cache intelligent\nconst CACHE_NAME = 'morgan-digital-v1.0.0';\nconst STATIC_CACHE = 'morgan-static-v1';\nconst DYNAMIC_CACHE = 'morgan-dynamic-v1';\n\nconst STATIC_ASSETS = [\n    '/',\n    '/style.css',\n    '/script.js',\n    '/portfolio-greenhorizens.webp',\n    'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap'\n];\n\n// Installation du Service Worker\nself.addEventListener('install', event => {\n    event.waitUntil(\n        caches.open(STATIC_CACHE)\n            .then(cache => cache.addAll(STATIC_ASSETS))\n            .then(() => self.skipWaiting())\n    );\n});\n\n// Activation du Service Worker\nself.addEventListener('activate', event => {\n    event.waitUntil(\n        Promise.all([\n            // Nettoyer les anciens caches\n            caches.keys().then(cacheNames => \n                Promise.all(\n                    cacheNames\n                        .filter(cacheName => \n                            cacheName !== STATIC_CACHE && \n                            cacheName !== DYNAMIC_CACHE\n                        )\n                        .map(cacheName => caches.delete(cacheName))\n                )\n            ),\n            self.clients.claim()\n        ])\n    );\n});\n\n// StratÃ©gie de cache\nself.addEventListener('fetch', event => {\n    const { request } = event;\n    const url = new URL(request.url);\n    \n    // Cache First pour les assets statiques\n    if (STATIC_ASSETS.includes(request.url) || request.url.includes('.css') || request.url.includes('.js')) {\n        event.respondWith(\n            caches.match(request)\n                .then(response => response || fetch(request))\n        );\n        return;\n    }\n    \n    // Network First pour les pages et API\n    if (request.method === 'GET' && url.origin === location.origin) {\n        event.respondWith(\n            fetch(request)\n                .then(response => {\n                    const responseClone = response.clone();\n                    caches.open(DYNAMIC_CACHE)\n                        .then(cache => cache.put(request, responseClone));\n                    return response;\n                })\n                .catch(() => caches.match(request))\n        );\n    }\n});\n`;\nif('serviceWorker'in navigator){const blob=new Blob([serviceWorkerCode],{type:'application/javascript'}),swUrl=URL.createObjectURL(blob);navigator.serviceWorker.register(swUrl).catch(console.warn)}document.addEventListener('DOMContentLoaded',()=>{window.performanceOptimizer=new PerformanceOptimizer}),'undefined'!=typeof module&&module.exports&&(module.exports=PerformanceOptimizer);