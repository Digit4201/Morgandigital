class SecureCountdown{constructor(){this.config={defaultDuration:7*24*60*60*1e3,updateInterval:1e3,minDuration:60*60*1e3,maxDuration:30*24*60*60*1e3,storageKey:'countdown_data',timezoneOffset:60},this.isRunning=!1,this.countdownInterval=null,this.endTime=null,this.elements={countdown:document.getElementById('pricing-countdown'),urgencyElements:document.querySelectorAll('.urgency-highlight')},this.init()}init(){try{this.validateEnvironment()?(this.loadCountdownData(),this.startCountdown(),this.bindEvents()):(console.warn('Environnement non sécurisé détecté'),this.setFallbackDisplay())}catch(e){console.error('Erreur initialisation countdown:',e),this.setFallbackDisplay()}}validateEnvironment(){return!0}loadCountdownData(){const e=localStorage.getItem(this.config.storageKey);if(e)try{const t=JSON.parse(e),n=new Date().getTime();t.endTime&&t.endTime>n?(this.endTime=t.endTime,console.log('Countdown restauré depuis le stockage')):(console.log('Countdown expiré, génération nouveau'),this.generateNewCountdown())}catch(e){console.error('Erreur lecture stockage:',e),this.generateNewCountdown()}else this.generateNewCountdown()}generateNewCountdown(){const e=new Date().getTime();this.endTime=e+this.config.defaultDuration,this.saveCountdownData(),console.log('Nouveau countdown généré')}saveCountdownData(){const e={endTime:this.endTime,created:new Date().getTime()};localStorage.setItem(this.config.storageKey,JSON.stringify(e))}startCountdown(){this.isRunning=!0,this.updateDisplay(),this.countdownInterval=setInterval(()=>{this.updateDisplay()},this.config.updateInterval)}updateDisplay(){if(!this.endTime)return;const e=new Date().getTime(),t=this.endTime-e;if(t<=0){this.handleCountdownEnd();return}const n=this.formatTimeRemaining(t);this.elements.countdown&&(this.elements.countdown.textContent=n),this.elements.urgencyElements.forEach(e=>{e.textContent=n})}formatTimeRemaining(e){const t=Math.floor(e/864e5),n=Math.floor(e%864e5/36e5),o=Math.floor(e%36e5/6e4);return t>0?`${t}j ${n}h`:`${n}h ${o.toString().padStart(2,'0')}min`}handleCountdownEnd(){this.stopCountdown(),this.generateNewCountdown(),this.startCountdown(),console.log('Countdown terminé, nouveau cycle démarré')}stopCountdown(){this.isRunning=!1,this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}setFallbackDisplay(){const e='7 jours';this.elements.countdown&&(this.elements.countdown.textContent=e),this.elements.urgencyElements.forEach(t=>{t.textContent=e})}bindEvents(){window.addEventListener('focus',()=>{this.isRunning&&this.updateDisplay()}),window.addEventListener('beforeunload',()=>{this.saveCountdownData()})}reset(){localStorage.removeItem(this.config.storageKey),this.generateNewCountdown(),this.isRunning&&this.updateDisplay()}}document.addEventListener('DOMContentLoaded',()=>{try{new SecureCountdown,console.log('✅ Countdown sécurisé initialisé')}catch(e){console.error('❌ Erreur countdown:',e)}});